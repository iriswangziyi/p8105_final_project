---
title: "Beer Tax Determined (In Barrels)"
output: 
  flexdashboard::flex_dashboard
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(flexdashboard)
# rmarkdown::render("dashboard_tax_state_map.Rmd", output_format = "flexdashboard::flex_dashboard") #knit for web
```


```{r}
tax_df = read_csv("../data_import_cleaning/tax.csv")
state_df = # arrange row order
  tibble(
    state = state.abb, # arrange row order according default state.abb
    state.name = state.name
  )

tax <- 
  left_join(state_df, tax_df, by = "state")

g <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  lakecolor = toRGB('white')
)

tax_2010 <- tax %>% pull(5)
tax_2011 <- tax %>% pull(6)
tax_2012 <- tax %>% pull(7)
tax_2013 <- tax %>% pull(8)
tax_2014 <- tax %>% pull(9)
tax_2015 <- tax %>% pull(10)
tax_2016 <- tax %>% pull(11)
tax_2017 <- tax %>% pull(12)
tax_2018 <- tax %>% pull(13)
tax_2019 <- tax %>% pull(14)
```
Map
=====================================  
Yearly Statistical Beer Data by State (2010 – 2019) from [Alcohol and Tobacco Tax and Trade Bureau](https://www.ttb.gov/beer/statistics)

Column
-------------------------------------
    
### Overall Trend
    
```{r trend}
tax_df %>%
  select(!c(3,4)) %>%
  filter(!(state %in% c("DC","total"))) %>%
  pivot_longer(
    c(`2008`:`2019`),
    names_to = "year",
    values_to = "tax"
  ) %>%
  mutate(text_label = str_c("state: ", state)) %>% # creating text label 
  plot_ly( 
    x = ~year, y = ~tax, color = ~factor(state), text = ~text_label,
    alpha = .5, type = "scatter", mode = "lines", colors = "viridis") %>%
  layout( # adding a title 
    title = "Tax Collected over the Years")

```
   
Column {.tabset .tabset-fade}
-------------------------------------

### Year 2010
```{r}
plot_geo() %>%
  add_trace(
    z = ~tax_2010, text = state.name, span = I(0),
    locations = state.abb, locationmode = 'USA-states'
  ) %>%
  layout(geo = g,
         title = "Tax Map") %>%
  config( fillFrame = TRUE)
```

### Year 2011
```{r}
plot_geo() %>%
  add_trace(
    z = ~tax_2011, text = state.name, span = I(0),
    locations = state.abb, locationmode = 'USA-states'
  ) %>%
  layout(geo = g) %>%
  config( fillFrame = TRUE)
```

### Year 2012
```{r}
plot_geo() %>%
  add_trace(
    z = ~tax_2012, text = state.name, span = I(0),
    locations = state.abb, locationmode = 'USA-states'
  ) %>%
  layout(geo = g) %>%
  config( fillFrame = TRUE)
```

### Year 2013
```{r}
plot_geo() %>%
  add_trace(
    z = ~tax_2013, text = state.name, span = I(0),
    locations = state.abb, locationmode = 'USA-states'
  ) %>%
  layout(geo = g) %>%
  config( fillFrame = TRUE)
```

### Year 2014
```{r}
plot_geo() %>%
  add_trace(
    z = ~tax_2014, text = state.name, span = I(0),
    locations = state.abb, locationmode = 'USA-states'
  ) %>%
  layout(geo = g) %>%
  config( fillFrame = TRUE)
```

### Year 2015
```{r}
plot_geo() %>%
  add_trace(
    z = ~tax_2015, text = state.name, span = I(0),
    locations = state.abb, locationmode = 'USA-states'
  ) %>%
  layout(geo = g) %>%
  config( fillFrame = TRUE)
```

### Year 2016
```{r}
plot_geo() %>%
  add_trace(
    z = ~tax_2016, text = state.name, span = I(0),
    locations = state.abb, locationmode = 'USA-states'
  ) %>%
  layout(geo = g) %>%
  config( fillFrame = TRUE)
```

### Year 2017
```{r}
plot_geo() %>%
  add_trace(
    z = ~tax_2017, text = state.name, span = I(0),
    locations = state.abb, locationmode = 'USA-states'
  ) %>%
  layout(geo = g) %>%
  config( fillFrame = TRUE)
```

### Year 2018
```{r}
plot_geo() %>%
  add_trace(
    z = ~tax_2018, text = state.name, span = I(0),
    locations = state.abb, locationmode = 'USA-states'
  ) %>%
  layout(geo = g) %>%
  config( fillFrame = TRUE)
```

### Year 2019
```{r}
plot_geo() %>%
  add_trace(
    z = ~tax_2019, text = state.name, span = I(0),
    locations = state.abb, locationmode = 'USA-states'
  ) %>%
  layout(geo = g) %>%
  config( fillFrame = TRUE)
```

Data
=====================================  
Yearly Statistical Beer Data by State (2010 – 2019) from [Alcohol and Tobacco Tax and Trade Bureau](https://www.ttb.gov/beer/statistics)
```{r}
knitr::kable(tax[,-c(3,4)])
# rmarkdown::render("dashboard_tax_state_map.Rmd", output_format = "flexdashboard::flex_dashboard") #knit for web
```

