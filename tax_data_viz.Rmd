---
title: "tax_data_vis"
author: "Amy Pitts"
date: "11/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plotly)
library(flexdashboard)
```

### get the data! 
```{r, warning=FALSE, message=FALSE}
tax_df         = read_csv( "data_import_cleaning/tax.csv")
tax_cans_df    = read_csv("data_import_cleaning/tax_cans.csv")
tax_barrels_df = read_csv("data_import_cleaning/tax_barrels_df.csv")
```

### Looking at just the taxes collected by state 
```{r}
tax_df %>%
  filter(state != "total") %>%
  pivot_longer(
    c(`2008`:`2019`),
    names_to = "year",
    values_to = "tax"
  ) %>%
  mutate(text_label = str_c("state: ", state)) %>% # creating text label 
  plot_ly( #using plotly to plot he tmax and tmin 
    x = ~year, y = ~tax, color = ~factor(state), text = ~text_label,
    alpha = .5, type = "scatter", mode = "lines", colors = "viridis") %>%
  layout( # adding a title 
    title = "Tax collected over the years by state")
```

### looking at the amount Barrels produced by state 

```{r}
tax_barrels_df %>%
  filter(state != "total") %>%
  pivot_longer(
    c(`2008`:`2019`),
    names_to = "year",
    values_to = "barrels"
  ) %>%
  mutate(text_label = str_c("state: ", state)) %>% # creating text label 
  plot_ly( #using plotly to plot he tmax and tmin 
    x = ~year, y = ~barrels, color = ~factor(state), text = ~text_label,
    alpha = .5, type = "scatter", mode = "lines", colors = "viridis") %>%
  layout( # adding a title 
    title = "Barrel production over the years by state")
```

### looking at the amount of cans and bottles produced by state over years 
```{r}
tax_cans_df %>%
  filter(state != "total") %>%
  pivot_longer(
    c(`2008`:`2019`),
    names_to = "year",
    values_to = "cans_bottles"
  ) %>%
  mutate(text_label = str_c("state: ", state)) %>% # creating text label 
  plot_ly( #using plotly to plot he tmax and tmin 
    x = ~year, y = ~cans_bottles, color = ~factor(state), text = ~text_label,
    alpha = .5, type = "scatter", mode = "lines", colors = "viridis") %>%
  layout( # adding a title 
    title = "Can and Bottleproduction over the years by state")
```

### Trying to find the tax rate per state 
to find the tax rate I cam going to add up the barrel and can and bottle production then use this to divide by the tax collected 
```{r}
state = tax_df %>% select(state) 
tax_rate_df =  tax_df %>% select(-state) /
  (tax_barrels_df %>% select(-state)  + 
   tax_cans_df %>%select(-state) ) 

tibble(state, tax_rate_df) %>%
  filter(state != "total") %>%
  pivot_longer(
    c(`2008`:`2019`),
    names_to = "year",
    values_to = "tax_rate"
  ) %>%
  mutate(text_label = str_c("state: ", state)) %>% # creating text label 
  plot_ly( #using plotly to plot he tmax and tmin 
    x = ~year, y = ~tax_rate, color = ~factor(state), text = ~text_label,
    alpha = .5, type = "scatter", mode = "lines", colors = "viridis") %>%
  layout( # adding a title 
    title = "Tax rate over the years by state")
```

might want to go in an look at the data for errors, that one spike looks very odd... might be missing values for some inflating the rate... 





