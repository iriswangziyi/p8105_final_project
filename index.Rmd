---
title: "Beer taxation in the United States - P8105 Data Science I Project"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

<h2 style="text-align: center;" markdown="1">Exploring the consumption, taxation, and production of beer in the United States.  </h2>
<h6 style="text-align: center;" markdown="1">By: Amy Pitts (ajp2257)| Ruiyang Li (rl3034)| Wenbo Fei (wf2270)| Ziyi Wang (zw2716)</h6>


<center>

![](beer-map.jpg){width=500px}

*Image from [The Best Beer By State](https://aleheads.wordpress.com/2012/07/09/the-best-beer-by-state/ )
</center>

---

## Introduction:
The US Government continues to control the consumption and production of Beer through regulations and taxes. The Alcohol and Tobacco Tax and Trade Bureau regulates people who engage in the alcohol beverage industry by requiring people to file an application before engaging in business [TTBGov - Beverage Alcohol, n.d.](https://www.ttb.gov/alcohol/beverage-alcohol). For Breweries in particular they are required to file documents every year and the data is compiled into publicly available sources [TTBGov - Beer Statistics, n.d.](https://www.ttb.gov/beer/statistics). Through this reporting and taxation, the US profits enormously off of Beer. Since beer plays such an important role in the US economy it is important to analyze the publicly available government data all about taxation and production [TTBGov - Beverage Alcohol, n.d.](https://www.ttb.gov/alcohol/beverage-alcohol). It is also equally interesting to look at the types of beer produced, location of breweries across the globe using an open-source API data set [Open Beer Database, n.d.](https://data.opendatasoft.com/explore/dataset/open-beer-database@public-us/table/). Our goal in this project is to get a better understanding of what kinds of beers are produced and how The US economy profits off of it.

---

## Longer Introduction:

Statistics have been intertwined with beer since the 20th century. During his time at Guinness Brewing Company of Dublin, Ireland mathematician Gosset published a paper in 1904 about using a Poisson distribution to model the amount of yeast cells in the Beer fermentation process (The Lady Tasting Tea). This helped lead to a much more accurate assessment of the concentration of yeast cells in the beer mash and thus a much more consistent product was produced by Guinness. However, due to not wanting to leak company secrets Guinness did not let Gosset publish in appropriate papers, this led him to publish his work under the name “Student” while he worked under Pearson (The Lady Tasting Tea).   

Beer has been around for centuries. When the Mayflower set sail from America they loaded up on all the essentials including lots of beer and when they ran out they decided to stop as soon as possible landing them on Plymouth rock. “We could not now take time for further search… our victuals being much spent, especially our beer…” [Beer & American History](https://www.beerinstitute.org/news-media/additional-beer-resources/beer-american-history/ ). To their surprise, the Native Americans had been brewing beer from maize way before they invaded their land. After that point brewers have been popping up all over the United States. Beer had become so important in the establishment of the American nation that “George Washington’s first acts as Commander of the Continental Army was to proclaim that every one of his troops would receive a quart of beer with his daily rations” [Beer & American History](https://www.beerinstitute.org/news-media/additional-beer-resources/beer-american-history/ ).  

Fast forward to after the prohibition the American Government continues to control the consumption and production of Beer through regulations and taxes. The Alcohol and Tobacco Tax and Trade Bureau protects “the public by enforcing the provisions of the Federal Alcohol Administration Act” [TTB.gov](https://www.ttb.gov/alcohol/beverage-alcohol). This helps regulate people who engage in the alcohol beverage industry by requiring people to file an application before engaging in business. For Breweries in particular they are required to file the yearly Brewer’s Report of Operations (TTB F 5130.9) and the Quarterly Brewer’s Report of Operations (TTB F 5130.26) [TTB.gov Statistics]( https://www.ttb.gov/beer/statistics). The Breweries must report this information no later than 15 days after the close of the applicable reporting period [TTB.gov Statistics]( https://www.ttb.gov/beer/statistics). Through this reporting and taxation, the U.S. profits enormously off of this one beverage. From a report, it is estimated that the American beer industry contributes to “more than $328 billion to our economy” [Beer Institute](https://www.beerinstitute.org/beer-policy/overview/). The jobs it creates are in a wide range of areas such as farming, manufacturing, construction, transportation, service, and more. Since beer plays such an important role in the U.S. economy it is important to analyze the publicly available government data all about taxation and production [TTB.gov](https://www.ttb.gov/alcohol/beverage-alcohol). It is also equally interesting to look at the types of beer produced, location of breweries across the globe using an open-source API data set [Open Beer Dataset](https://data.opendatasoft.com/explore/dataset/open-beer-database%40public-us/table/).  
Our goal in this project is to get a better understanding of the taxation, consumption and production of beer by each state to get a better understanding of how the United States profits off beer. 

---

## Screencast*

---

## Datasets

* Yearly Statistical Beer Data by State (2008 – 2019) from [Alcohol and Tobacco Tax and Trade Bureau](https://www.ttb.gov/beer/statistics). This aggregated data contained records on Tax Determined, Taxable Volume of Bottles and Cans, Taxable Volume of Barrels and Kegs each year for each state in barrels.

* Open Beer database from [Opendatasoft](https://data.opendatasoft.com/explore/dataset/open-beer-database%40public-us/information/?rows=4588&timezone=&refine.country=United+States&location=2,16.98232,9.498&basemap=jawg.sunny&dataChart=eyJxdWVyaWVzIjpbeyJjb25maWciOnsiZGF0YXNldCI6Im9wZW4tYmVlci1kYXRhYmFzZUBwdWJsaWMtdXMiLCJvcHRpb25zIjp7fX0sImNoYXJ0cyI6W3siYWxpZ25Nb250aCI6dHJ1ZSwidHlwZSI6ImxpbmUiLCJmdW5jIjoiQVZHIiwieUF4aXMiOiJhYnYiLCJzY2llbnRpZmljRGlzcGxheSI6dHJ1ZSwiY29sb3IiOiIjMTQyRTdCIn1dLCJ4QXhpcyI6Imxhc3RfbW9kIiwibWF4cG9pbnRzIjoiIiwidGltZXNjYWxlIjoieWVhciIsInNvcnQiOiIifV0sImRpc3BsYXlMZWdlbmQiOnRydWUsImFsaWduTW9udGgiOnRydWV9). This dataset contains information of each beer product, including product name, universal product code, style, category, brewer along with its address and website, percentage of alcohol by volume, bitterness from hops in a beer, beer color, and description in text.

* This data is gotten from the [American Beer Distributors](https://www.nbwa.org/resources/state-data). This website aims to collect data on beer consumption, taxation and shipment. They have produced a number of there own reports but they have the data they used aviable in pdf form. The pdf document are [Summary of Effective State Excise Tax Rates by State](https://www.nbwa.org/sites/default/files/Beer%20Excise%20Tax%202019%20-%20Revised%20July%202020.pdf)
and [Shipments of Malt Beverages and Per Capita Consumption by State](https://www.nbwa.org/sites/default/files/2003%20and%202019%20State%20data%20Per%20Capita%20Sheets_1.pdf). Due to the difficult of working with pdf documents in R and pdf to excel online file converter was used to access this data. These files include data on taxation rate per barrel, shipment of beer, consumption of beer per capita, and population over the age of 21. 

---

## Findings

```{r setup, include = F}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plotly)
library(flexdashboard)
library(leaflet)
library(sf)
library(mapview)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

```

```{r read_df, collapse = T, message = F, warning = F, include = F}
tax_df = read_csv("./data_import_cleaning/tax.csv")
beer = read_csv("./data_import_cleaning/beer.csv")
```

---

### Beer Tax in U.S. State
```{r tax map, collapse = T, message = F, warning = F}
state_df = 
  tibble(
    state = state.abb, # arrange row order according default state.abb
    state.name = state.name
  )

tax <- 
  left_join(state_df, tax_df, by = "state") %>% # arrange row order
  pull(3) # take year 2008 record, MS has NA
# View(density)

g <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  lakecolor = toRGB('white')
)

plot_geo() %>%
  add_trace(
    z = ~tax, text = state.name, span = I(0),
    locations = state.abb, locationmode = 'USA-states'
  ) %>%
  layout(geo = g)
```

---

## U.S. brewers Location mapping
 Map location of each US brewer with category/style, size of marker showing ABV (Alcohol by volume) and interactive label showing the tax info by state.
```{r brewer map, collapse = T, message = F, warning = F}
#install.packages("leaflet")
library(leaflet)

pal <- colorNumeric(
  palette = "viridis",
  domain = beer$alcohol_by_volume)

beer %>% 
  filter(alcohol_by_volume != 0) %>% 
  mutate(
    click_label = 
      str_c("<b>Brewer: ", name,
            "<br>ABV: ", alcohol_by_volume, 
            "</b><br>City: ", city, 
            "<br>State: ", state
            )
  ) %>% 
  leaflet() %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addCircleMarkers(~longitude, ~latitude,
                   clusterOptions = markerClusterOptions(),
                   radius = 0.1, 
                   color = ~pal(alcohol_by_volume), 
                   popup = ~click_label)
```

