---
title: "Consumption"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plotly)
library(flexdashboard)

state_df = read_csv("data_import_cleaning/state_df.csv")
beer = read_csv("./data_import_cleaning/beer.csv")
```

## Consumption
This graph shows data from the [Shipments of Malt Beverages and Per Capita Consumption by State](https://www.nbwa.org/sites/default/files/2003%20and%202019%20State%20data%20Per%20Capita%20Sheets_1.pdf) document. This consumption is by captiate and only considers individuals who are 21 years old or older. 
```{r warning=FALSE, message=FALSE}
state_df %>%
  filter(year > 2009) %>%
  mutate(text_label = str_c("state: ", state)) %>% # creating text label 
  plot_ly( #using plotly to plot he tmax and tmin 
    x = ~year, y = ~consumption, color = ~factor(state), text = ~text_label,
    alpha = .5, type = "scatter", mode = "lines", colors = "viridis") %>%
  layout( # adding a title 
    title = "Consumption")
```

---

## Alcohol by volume (ABV) pattern

**Alcohol by volume (ABV):** volume percent of alcohol (ethanol) contained in a given volume of an alcoholic beverage

**Pattern of interest:** What category/brewer/style of beer has the most ABV?

### By category

```{r cat_abv,collapse=TRUE}
cat_abv = 
  beer %>% 
  replace_na(list(category = "NA", y = "unknown")) %>% 
  group_by(category) %>% 
  summarise(mean_abv = mean(alcohol_by_volume)) %>% 
  arrange(desc(mean_abv)) 
cat_abv

cat_abv %>% 
  mutate(category = fct_reorder(category, mean_abv)) %>% 
  plot_ly(x = ~category, y = ~mean_abv, color = ~category, type = "bar", colors = "viridis")

beer %>% 
  mutate(category = fct_reorder(category, alcohol_by_volume)) %>% 
  plot_ly(y = ~alcohol_by_volume, color = ~category, type = "box", colors = "viridis")
```

### By brewer

* Top 20

```{r brewer_abv,collapse=TRUE}
brewer_abv = 
  beer %>% 
  group_by(brewer) %>% 
  summarise(mean_abv = mean(alcohol_by_volume)) %>% 
  arrange(desc(mean_abv))
brewer_abv

brewer_abv %>% 
  slice(1:20) %>% 
  mutate(brewer = fct_reorder(brewer, mean_abv)) %>%
  plot_ly(x = ~brewer, y = ~mean_abv, color = ~brewer, type = "bar", colors = "viridis") %>% 
  layout(yaxis = list(range = c(8, 11)))

top_20_brewer = brewer_abv %>% slice(1:20) %>% select(brewer) %>% unlist()
beer %>% 
  filter(brewer %in% top_20_brewer) %>% 
  mutate(brewer = fct_reorder(brewer, alcohol_by_volume)) %>% 
  plot_ly(y = ~alcohol_by_volume, color = ~brewer, type = "box", colors = "viridis")
```

### By style

* Top 20

```{r style_abv,collapse=TRUE}
style_abv = 
  beer %>% 
  group_by(style) %>% 
  summarise(mean_abv = mean(alcohol_by_volume)) %>% 
  arrange(desc(mean_abv))
style_abv

style_abv %>% 
  slice(1:20) %>% 
  mutate(style = fct_reorder(style, mean_abv)) %>% 
  plot_ly(x = ~style, y = ~mean_abv, color = ~style, type = "bar", colors = "viridis") %>% 
  layout(yaxis = list(range = c(5.5, 12)))

top_20_style = style_abv %>% slice(1:20) %>% select(style) %>% unlist()
beer %>% 
  filter(style %in% top_20_style) %>% 
  mutate(style = fct_reorder(style, alcohol_by_volume)) %>% 
  plot_ly(y = ~alcohol_by_volume, color = ~style, type = "box", colors = "viridis")
```


